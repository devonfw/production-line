= Devon4J My-Thai-Star Sample Application Template for Production Line

image::doc/images/devonfw.png[DevonFW Logo]


== Introduction

This template will configure your PL instance to have a 'ready to use' My-Thai-Star Devon application, to be used as a starting point for your project. This includes:

* Cloning the official `My-Thai-Star` (https://github.com/devonfw/my-thai-star) repository into your GitLab, which allows you to do customizations on your own.

* Adding a build job for the Angular front-end, including a SonarQube analysis and a deployment to Nexus.

* Adding a build job for the Java back-end, including a SonarQube analysis and a deployment to Nexus.

* Adding a deployment job for the Angular front-end

* Adding a deployment job for the Java back-end

* Adding a 'full-deployment' job that triggers the deployment of both components

Especially the build and delpoyment jobs require several additional Jenkins plugins, which are not part of the PL by default. The Template will also take care of those installations.

All build and deployment jobs are taken from the official `My-Thai-Star` (https://github.com/devonfw/my-thai-star) repository. The created jobs inside Jenkins use the Jenkinsfiles from the cloned repo in Gitlab.

== How to report Issues

This template is independent from PL and devon releases and is also not really connected to one of the projects. Therefore issues that occur during the template setup or execution should be tracked in the issue section of this GitHub project. 

== How to contribute

In case you see improvements we would love to see a Pull Request.



== Prerequisities

[WARNING]
====
Right now you need add the PL Jenkins SharedLib manually with the name "ProductionLineTemplateLib" in Jenkins https://github.com/devonfw-forge/devon-production-line-shared-lib.git.
====

 
=== Production Line Components

To use the template you need to make sure that:

* You PL has the following components installed:

** Jenkins (required to run the template and to execute the build/deployment Jobs)
** SonarQube (required for a static code analysis)
** GitLab (required as a repostiory)
** Nexus (required to store the build artifacts)


[TIP]
====
Additional components can be ordered from the ProductionLine service team.
====

=== Technical User Setup 

In order to configure the services, we need technical users for the following components:

* Gitlab
* Nexus3

==== Gitlab

The creation of the GitLab Group and Project will require a private GitLab token which has to be provided manually. The token can be obtained like this:


1. Go to your Profile in Gitlab

image::./doc/images/profile.png[500,400]

2. Next click on the pen icon

image::./doc/images/pen.png[500,400]

3. On the left menu choose Access Tokens and put token name and check fields like below +

image::./doc/images/token.JPG[600,500]

4. Click "Create personal access token", you should receive notification about created token and token string. Copy the token string.

image::./doc/images/created_token.JPG[600,500]



[IMPORTANT]
====
The GitLab API user needs to have API access and the rights to create a new group. To set this permission follow the next steps:
====

1. Enter the Admin control panel
2. Select 'Users'
3. Select the user(s) in question and click 'Edit'
4. Scroll down to 'Access' and un-tick 'Can Create Group'


==== Technical Nexus user 

===== Create the technical Nexus User
https://km3.capgemini.com/book/1089771

1. The nexus3-api user should be created in section Administration

image::./doc/images/nexusadmin.png[600,500]

2. New user should have added roles: Admins, nx-admins

image::./doc/images/nexususer.png[600,500]


=====  Add it as credential in Jenkins

Credentials 'nexus-api' user should be added to Jenkins
Jenkins -> Credentials -> System -> Global credentials (unrestricted) -> Add Credentials

image::./doc/images/credential.png[800,500]


=====  Add the user to maven global settings in Jenkins:

1. Jenkins -> Managed Files -> Edit Global Maven Settings XML

image::./doc/images/mavensettings.png[600,500]

2.  Add the credential to the settings xml, use the ID "pl-nexus"

image::./doc/images/mavensettings2.png[600,500]


=== Deployment Requirements

In case you want to use the deployment jobs, make sure you:

* Have an additional test-server (a PL does not include a test environment, so a separate Linux machine is required)

** SSH access should be available through an SSH-RSA key
** Docker-CE has to be installed
** Docker-Compose has to be installed



== How to run it

Just do it

== Expected results

Everything works